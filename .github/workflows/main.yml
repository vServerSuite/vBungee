on: [release]
name: Deploy to Bungee
jobs:
  Build:
    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v2
      with:
        fetch-depth: 2
    - name: Set up JDK 1.8
      uses: actions/setup-java@v1
      with:
        java-version: 1.8
    - name: Build with Maven
      run: mvn install --file pom.xml
    - name: Deploy
      uses: SamKirkland/FTP-Deploy-Action@3.0.0
      with:
        ftp-server: ${{ secrets.FTP_SERVER }}
        ftp-username: ${{ secrets.FTP_USERNAME }}
        ftp-password: ${{ secrets.FTP_PASSWORD }}
        local-dir: ./target
        git-ftp-args: --insecure
    - name: Send Restart Command
      uses: wei/curl@v1
      with:
        args: https://panel.benh.codes/api/client/servers/${{ secrets.PTERODACTYL_SERVER_ID }}/command -H 'Authorization:Bearer ${{ secrets.PTERODACTYL_API_KEY }}' -H 'Content-Type:application/json' -H 'Accept:Application/vnd.pterodactyl.v1+json' -X POST -d '{ "command":"grestart 5m Network Maintenance" }'
